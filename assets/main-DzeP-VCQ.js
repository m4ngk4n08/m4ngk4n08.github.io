(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function t(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(o){if(o.ep)return;o.ep=!0;const s=t(o);fetch(o.href,s)}})();function w(){for(var n=document.getElementsByClassName("collapsible"),e=0;e<n.length;e++){n[e].classList.toggle("active");var t=n[e].nextElementSibling;t.style.display==="block"?t.style.display="none":t.style.display="block"}}window.toggleSection=w;let i=null;const b=["./sql/whodunnitone_crime_scene_report.sql","./sql/whodunnitone_evidence.sql","./sql/whodunnitone_guest_list.sql","./sql/whodunnitone_person.sql","./sql/whodunnitone_person_information.sql","./sql/whodunnitone_security_footage.sql","./sql/whodunnitone_statement.sql","./sql/whodunnitone_network_logs.sql","./sql/whodunnitone_safe_logs.sql","./sql/encrypted_keys.sql"];async function y(n=[]){if(i)return i;try{const e=await initSqlJs({locateFile:t=>t==="sql-wasm.wasm"?window.sqlWasmPath:`https://cdn.jsdelivr.net/npm/sql.js@1.8.0/dist/${t}`});if(i=new e.Database,n.length>0)for(const t of n)try{const r=await fetch(t);if(!r.ok)throw new Error(`Failed to load SQL file ${t}: ${r.statusText}`);const o=await r.text();i.exec(o)}catch(r){console.error(`Error loading SQL file ${t}:`,r)}else console.log("Database initialized without SQL files.");return i}catch(e){throw console.error("Error initializing database:",e),e}}function p(){if(!i)throw new Error("Database not initialized. Call initializeDatabase() first.");return i}function E(n){return p().exec(n)}y(b).then(()=>{console.log("Database loaded successfully!"),document.getElementById("decryptionBtn").disabled=!1,document.getElementById("vaultBtn").disabled=!1}).catch(n=>{console.error("Error loading database:",n)});const d={initialize:y,getInstance:p,execute:E};function v(n){var e=n.trim();if(e)try{const t=g(e),r=d.execute(`select * from encrypted_keys where key = '${t}'`);if(r.length<=0){document.getElementById("section-result").innerHTML="Key not found";return}if(r[0].values[0][2]=="vault"){document.getElementById("section-result").innerHTML="Congratulations! You've cracked the vault and found the heirloom inside the vault. Diddleworths family is very grateful for your help, they will now gave you a reward and moved on in their lives because that's how life works. You can now also move on in your life and forget about this case. Good luck! <br/> <br/> ps: Sorry for wasting your time.";return}d.execute(`update encrypted_keys set decrypted = 1 where key = '${t}'`),document.getElementById("section-result").innerHTML=`${r[0].values[0][2]} are decrypted!`}catch(t){console.error("Error executing SQL query:",t),document.getElementById("section-result").innerHTML="Error: "+t.message}}function g(n){var e="";const t="whodunnitone";for(;n.length<t.length;)n+=n;for(var r=0;r<t.length;r++){var o=t[r].charCodeAt(0),s=n[r].charCodeAt(0),l=o^s,a=l.toString(16);a.length<2&&(a="0"+a),e+=a}return e}window.checkKey=v;window.encryptKey=g;document.addEventListener("DOMContentLoaded",function(){const n=CodeMirror.fromTextArea(document.getElementById("sqlQuery"),{mode:"text/x-sql",theme:"material",lineNumbers:!0,indenthWithTabs:!0,smartIndent:!0,matchBrackets:!0,autofocus:!0,tabSize:2,lineWrapping:!0,extraKeys:{"Ctrl-Space":"autocomplete","Ctrl-Enter":function(e){const t=e.getValue();h(t)}}});document.getElementById("sqlQueryBtn").addEventListener("click",function(){const e=n.getValue();h(e)})});function h(n){if(n!=="")try{const e=d.execute(n);if(!n.toLowerCase().startsWith("select")){document.getElementById("output").innerHTML="Only select queries are allowed.";return}if(e.length===0||e[0].values.length===0){document.getElementById("output").innerHTML="No results found.";return}q(e[0].columns,e[0].values)}catch(e){document.getElementById("output").innerHTML="Error: "+e.message}}function q(n,e){const t=document.createElement("table");t.setAttribute("border","1"),t.style.borderCollapse="collapse",t.style.width="100%";let r=!0;const o=n.indexOf("statement");var s=d.execute("select decrypted from encrypted_keys where table_name = 'statement'");o!==-1&&s[0].values[0][0]===1&&(r=!1);const l=document.createElement("tr");n.forEach(u=>{const c=document.createElement("th");c.innerText=u,l.appendChild(c)}),t.appendChild(l),e.forEach(u=>{const c=document.createElement("tr");u.forEach(m=>{const f=document.createElement("td");m===u[o]&&r?f.textContent=L():f.textContent=m,c.appendChild(f)}),t.appendChild(c)});const a=document.getElementById("output");a.innerHTML="",a.appendChild(t),a.style.display="block"}function L(){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let e="",t=Math.floor(Math.random()*22)+22;for(let r=0;r<t;r++)e+=n.charAt(Math.floor(Math.random()*n.length));return e}
